/*
 * Gritter for jQuery
 * http://www.boedesign.com/
 *
 * Copyright (c) 2011 Jordan Boesch
 * Dual licensed under the MIT and GPL licenses.
 *
 * Date: March 29, 2011
 * Version: 1.7.1
 */
(function(d){d.gritter={};d.gritter.options={position:"",fade_in_speed:"medium",fade_out_speed:1E3,time:6E3,close_on_click:false};d.gritter.add=function(a){try{return g.add(a||{})}catch(c){var b="Gritter Error: "+c;typeof console!="undefined"&&console.error?console.error(b,a):alert(b)}};d.gritter.remove=function(a,c){g.removeSpecific(a,c||{})};d.gritter.removeAll=function(a){g.stop(a||{})};var g={position:"",fade_in_speed:"",fade_out_speed:"",time:"",close_on_click:"",_custom_timer:0,_item_count:0,
_is_setup:0,_tpl_close:'<div class="gritter-close"></div>',_tpl_item:'<div id="gritter-item-[[number]]" class="gritter-item-wrapper [[item_class]]" style="display:none"><div class="gritter-top"></div><div class="gritter-item">[[image]]<div class="[[class_name]]"><span class="gritter-title">[[username]]</span><p>[[text]]</p></div><div style="clear:both"></div></div><div class="gritter-bottom"></div></div>',_tpl_wrap:'<div id="gritter-notice-wrapper"></div>',add:function(a){if(!a.title||!a.text)throw'You need to fill out the first 2 params: "title" and "text"';
this._is_setup||this._runSetup();var c=a.title,b=a.text,e=a.image||"",f=a.sticky||false,i=a.class_name||"",j=d.gritter.options.position,l=a.time||"",n=a.close_on_click||false,o=a.on_click||function(){};this._verifyWrapper();this._item_count++;var h=this._item_count,m=this._tpl_item;d(["before_open","after_open","before_close","after_close"]).each(function(p,q){g["_"+q+"_"+h]=d.isFunction(a[q])?a[q]:function(){}});this._custom_timer=0;if(l)this._custom_timer=l;m=this._str_replace(["[[username]]","[[text]]",
"[[image]]","[[number]]","[[class_name]]","[[item_class]]"],[c,b,e!=""?'<img src="'+e+'" class="gritter-image" />':"",this._item_count,e!=""?"gritter-with-image":"gritter-without-image",i],m);this["_before_open_"+h]();d("#gritter-notice-wrapper").addClass(j).append(m);var k=d("#gritter-item-"+this._item_count);k.fadeIn(this.fade_in_speed,function(){g["_after_open_"+h](d(this))});f||this._setFadeTimer(k,h);d(k).bind("click",o);d(k).bind("mouseenter mouseleave",function(p){if(p.type=="mouseenter")f||
g._restoreItemIfFading(d(this),h);else f||g._setFadeTimer(d(this),h);g._hoverState(d(this),p.type)});n&&d(k).bind("click",function(){g.removeSpecific(h,{},d(k),true)});return h},_countRemoveWrapper:function(a,c,b){c.remove();this["_after_close_"+a](c,b);d(".gritter-item-wrapper").length==0&&d("#gritter-notice-wrapper").remove()},_fade:function(a,c,b,e){b=b||{};var f=typeof b.fade!="undefined"?b.fade:true;fade_out_speed=b.speed||this.fade_out_speed;manual_close=e;this["_before_close_"+c](a,manual_close);
e&&a.unbind("mouseenter mouseleave");f?a.animate({opacity:0},fade_out_speed,function(){a.animate({height:0},300,function(){g._countRemoveWrapper(c,a,manual_close)})}):this._countRemoveWrapper(c,a)},_hoverState:function(a,c){if(c=="mouseenter"){a.addClass("hover");var b=a.find("img");b.length?b.before(this._tpl_close):a.find("span").before(this._tpl_close);a.find(".gritter-close").click(function(){var e=a.attr("id").split("-")[2];g.removeSpecific(e,{},a,true)})}else{a.removeClass("hover");a.find(".gritter-close").remove()}},
removeSpecific:function(a,c,b,e){b||(b=d("#gritter-item-"+a));this._fade(b,a,c||{},e)},_restoreItemIfFading:function(a,c){clearTimeout(this["_int_id_"+c]);a.stop().css({opacity:""})},_runSetup:function(){for(opt in d.gritter.options)this[opt]=d.gritter.options[opt];this._is_setup=1},_setFadeTimer:function(a,c){this["_int_id_"+c]=setTimeout(function(){g._fade(a,c)},this._custom_timer?this._custom_timer:this.time)},stop:function(a){var c=d.isFunction(a.before_close)?a.before_close:function(){},b=d.isFunction(a.after_close)?
a.after_close:function(){};a=d("#gritter-notice-wrapper");c(a);a.fadeOut(function(){d(this).remove();b()})},_str_replace:function(a,c,b,e){var f=0,i=0,j="",l="",n=0,o=0;a=[].concat(a);c=[].concat(c);var h=c instanceof Array,m=b instanceof Array;b=[].concat(b);if(e)this.window[e]=0;f=0;for(n=b.length;f<n;f++)if(b[f]!==""){i=0;for(o=a.length;i<o;i++){j=b[f]+"";l=h?c[i]!==undefined?c[i]:"":c[0];b[f]=j.split(a[i]).join(l);if(e&&b[f]!==j)this.window[e]+=(j.length-b[f].length)/a[i].length}}return m?b:b[0]},
_verifyWrapper:function(){d("#gritter-notice-wrapper").length==0&&d("body").append(this._tpl_wrap)}}})(jQuery);
